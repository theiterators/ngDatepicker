angular.module("jkuri.datepicker",[]).directive("ngDatepicker",["$document",function(e){"use strict";return{restrict:"EA",require:"?ngModel",scope:{},link:function(a,n,r,t){!function(e,a){e.format=a.format||"YYYY-MM-DD",e.viewFormat=a.viewFormat||"Do MMMM YYYY",e.locale=a.locale||"en",e.tabIndex=a.tabIndex||"1",e.firstWeekDaySunday=e.$eval(a.firstWeekDaySunday)||!1,e.placeholder=a.placeholder||"",e.onBlurDisable=!1}(a,r),a.calendarOpened=!1,a.days=[],a.dayNames=[],a.viewValue=null,a.dateValue=null,a.mouseIsOnCalendar=!1,a.id=Math.floor(68789*Math.random()+1),a.error=!1,moment.locale(a.locale);var l=moment(),o=function(e){var n=e.endOf("month").date(),r=e.month(),t=e.year(),l=1,o=!0===a.firstWeekDaySunday?e.set("date",2).day():e.set("date",1).day();1!==o&&(l-=o-1),2==l&&(l=-5),a.dateValue=e.format("MMMM YYYY"),a.days=[];for(var d=l;d<=n;d+=1)d>0?a.days.push({day:d,month:r+1,year:t,enabled:!0}):a.days.push({day:null,month:null,year:null,enabled:!1})};!function(){for(var e=!0===a.firstWeekDaySunday?moment("2015-06-07"):moment("2015-06-01"),n=0;n<7;n+=1)a.dayNames.push(e.format("ddd")),e.add("1","d")}(),a.keypressed=function(e){if(13==e.keyCode){var n=a.viewValue?moment(a.viewValue,a.viewFormat):null;t.$setViewValue(n.format(a.format)),a.viewValue=n.format(a.viewFormat),null!=n&&(t.$setViewValue(n.format(a.format)),a.viewValue=n.format(a.viewFormat),"Invalid date"===n.format(a.viewFormat)?a.error=!0:a.error=!1),document.getElementById(a.id).blur(),a.closeCalendar()}else if(27==e.keyCode){n=moment(t.$modelValue);a.viewValue=n.format(a.viewFormat),a.closeCalendar(),a.error=!1}},a.onBlur=function(){if(console.log(a.tabIndex),null!=a.viewValue&&!a.mouseIsOnCalendar){var e=moment(a.viewValue,a.viewFormat);t.$setViewValue(e.format(a.format)),a.viewValue=e.format(a.viewFormat),"Invalid date"===e.format(a.viewFormat)?a.error=!0:a.error=!1,a.closeCalendar()}},a.showCalendar=function(){a.calendarOpened=!0,o(l)},a.onCalendar=function(e){a.mouseIsOnCalendar=e},a.closeCalendar=function(){a.calendarOpened=!1},a.prevYear=function(){l.subtract(1,"Y"),o(l)},a.prevMonth=function(){l.subtract(1,"M"),o(l)},a.nextMonth=function(){l.add(1,"M"),o(l)},a.nextYear=function(){l.add(1,"Y"),o(l)},a.selectDate=function(e,n){e.preventDefault();var r=moment(n.day+"."+n.month+"."+n.year,"DD.MM.YYYY");e.preventDefault(),t.$setViewValue(r.format(a.format)),a.viewValue=r.format(a.viewFormat),a.error=!1,a.closeCalendar()};var d=["ng-datepicker","ng-datepicker-input"];void 0!==r.id&&d.push(r.id),e.on("click",function(e){if(a.calendarOpened){var n,r=0;if(e.target){for(n=e.target;n;n=n.parentNode){var l=n.id,o=n.className;if(void 0!==l)for(r=0;r<d.length;r+=1)if(l.indexOf(d[r])>-1||o.indexOf(d[r])>-1)return}var i=a.viewValue?moment(a.viewValue,a.viewFormat):null;t.$setViewValue(i&&i.format(a.format)),a.viewValue=i&&i.format(a.viewFormat),a.closeCalendar(),a.$apply()}}}),t.$render=function(){var e=t.$viewValue;void 0!==e&&(a.viewValue=moment(e).format(r.viewFormat),a.dateValue=e)}},template:'<div><input id="{{id}}" tabindex="{{tabIndex}}" type="text" ng-focus="showCalendar()" ng-keydown="keypressed($event)" ng-model="viewValue" ng-class="{isInvalidDate: error}" ng-blur="onBlur()" class="ng-datepicker-input" placeholder="{{ placeholder }}"></div><div class="ng-datepicker" ng-show="calendarOpened" ng-mouseover="onCalendar(true)" ng-mouseleave="onCalendar(false)">  <div class="controls">    <div class="left">      <i class="fa fa-backward prev-year-btn" ng-click="prevYear()"></i>      <i class="fa fa-angle-left prev-month-btn" ng-click="prevMonth()"></i>    </div>    <span class="date" ng-bind="dateValue"></span>    <div class="right">      <i class="fa fa-angle-right next-month-btn" ng-click="nextMonth()"></i>      <i class="fa fa-forward next-year-btn" ng-click="nextYear()"></i>    </div>  </div>  <div class="day-names">    <span ng-repeat="dn in dayNames">      <span>{{ dn }}</span>    </span>  </div>  <div class="calendar">    <span ng-repeat="d in days">      <span class="day" ng-click="selectDate($event, d)" ng-class="{disabled: !d.enabled}">{{ d.day }}</span>    </span>  </div></div>'}}]);